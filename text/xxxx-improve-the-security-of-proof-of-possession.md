# RFC-XXXX: Adding customized mandatory context to proof of possession statement

|                 |                                                                                                 |
|-----------------|-------------------------------------------------------------------------------------------------|
| **Start Date**  | 20 May 2025 2025                                                                                |
| **Description** | Change `SessionKeys` runtime api to generate an customized ownership proof for each crypto type |
| **Authors**     | Andrew Berger - Syed Hosseini                                                                   |

## Summary

This RFC is an amendment to RFC-0048. It proposes to change the `OpaqueKeysInner:create_ownership_proof` and `OpaqueKeys:: ownership_proof_is_valid` 
to invoke generation and validation procedure specific to each crypto time. This enable different crypto scheme implement 
the proof of possession fitted to their security need. In short, this RFC delegates the procedure of generating and validating proof of possession to the crypto scheme.


## Motivation

Following RFC-0048, All submitted key  accompany a signature of `account_id` by the same key proving that the submitter knows the private key corresponding to the submitted key. However, a scheme might need to mandate a context for generating proof of possession and a different context for signing anything else to prevent rogue key attack. While this is critical for scheme with aggregatable public key, the other (non-aggregatable) crypto scheme opt for backward compatiblity and accept signatures not prepended with mandatory context.

Current RFC, however does not allow for using different api and procedure for generating proof of possession for different crypto scheme.

After this RFC, the procedure for generating and verifying proof of possession would be in discretion of the crypto scheme themselves not deterministically tied to the way they sign other messages.

## Stakeholders

- Polkadot runtime implementors
- Polkadot node implementors
- Validator operators

## Explanation

The RFC does not change the structure introduced by RFC-0048. The proof is a sequences of
signatures:
```rust
type Proof = (Signature, Signature, ..);
```

However to generate each signature are generated by the crypto scehem instead of being each private session key signing the `account_id`. 
By default, the following statement signed by the crypto scheme is:

```
rust
"POP_"|account_id
```
However, new crypto scheme could specify different structure for their proof of possession.

Because RFC-0048 has not been deployed, the version of the `SessionKeys` could be set to `1` as requested by RFC-0048.

## Drawbacks

Crypto scheme needs to implement a `generate_proof_of_possession` and `verify_proof_of_possession` in addition to old capabilities (`sigen`, `verify`, etc).

## Testing, Security, and Privacy

The proof of possession for current crypto schemes is virtually the same as the one defined in RFC-0048. On the other hand the changes proposed by this RFC, allows the generation secure proof of possession for BLS keys.

## Performance, Ergonomics, and Compatibility

### Performance

The performance is the same as the one discussed in RFC-0048.

### Ergonomics

Separating generation of proof of possession from signing, it allows more freedom to crypto scheme to implement proof of possession fitted to their need. 

### Compatibility

The significant difference, is that proof of possession suggested by  RFC-0048 is signed:

```
rust
account_id
```

vs current proposal suggests to change the statement to:
```
rust
"POP_"|account_id
```

for the current crypto scheme. However, future crypto scheme such as BLS which are not bound to backward compatibility could produce more sophisticated proof of possession. 

## Prior Art and References

This is a minor amendment to RFC-0048.

## Unresolved Questions

None.

## Future Directions and Related Material

Substrate implementation of the generation of proof of possession for all crypto scheme (current and the experimental ones) is implemented in [Pull 6010](https://github.com/paritytech/polkadot-sdk/pull/6010).

Substrate implementation of [RFC-0048](https://github.com/paritytech/polkadot-sdk/pull/1739).

Implementation of `OpaqueKeysInner:create_ownership_proof` and `OpaqueKeys:: ownership_proof_is_valid` should call `generate_proof_of_possion` and `verify_proof_of_possession` runtime APIs rather directly calling sign.
